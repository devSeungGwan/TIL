# 이력 관리

시간의 경과에 따라 데이터의 일부 혹은 전체가 변경되거나 변경된 이후에도 변경 전 상태의 정보를 재현 할 필요가 있는 데이터를 모델링하여 관리하는 것이다.

이력 데이터를 모델링해야 하는 **이유**는

- 데이터의 변경 전/후 내용을 모두 기록 할 수 있는 데이터 구조를 설계하고, 시간의 경과에 따라 데이터와 관계가 변할 수 있으므로 변경 이후에도 과거의 데이터를 참조할 수 있도록 하기 위해서다.
- 데이터는 그냥 변경되는 것이 아니기 때문에 반드시 이를 변경하는 업무 행위가 존재하고, 각 업무 행위별로 어떤 데이터를 변경하는 지 상세하게 확인해야 되기 때문이다.

# **이력 데이터 종류**

## 발생 이력 데이터

- 어떤 데이터가 발생할 때마다 이력 정보를 남겨야 할 때 발생 이력이라 볼 수 있다.
- 이벤트성 이력 데이터를 관리하기 위해 이벤트가 발생할 때만 이력 데이터를 남기거나, 이벤트가 발생하지 않더라도 이력데이터를 생성하는 경우도 있다.

## 변경 이력 데이터

- 데이터가 변경될 때마다 변경 전과 후의 차이를 확인해야 한다면 변경 이력을 남길 수 있다.

## 진행 이력 데이터

- 업무의 진행에 따라 이 데이터를 이력 정보로 생성해야 한다면 진행 이력이라 볼 수 있다.
- 주문의 경우, 각 단계가 누구에 의해서 처리되고, 현재 단계는 무엇인지에 대한 정보가 필요하고 업무를 처리하기 위해 진행 이력 데이터가 필요하다.

# **이력 관리 형태**

## 시점 이력(=점이력)

- 특정 시점에 데이터가 변경되면 새로운 인스턴스가 생겨나고, 그 시점의 변경 데이터의 발생 시각을 기록 및 보관함으로써 데이터 변경 기록을 관리할 수 있다.
- 정밀한 이력관리가 어렵다.
- 변화가 발생하지 않아도 이력 데이터를 생성할 수 있다.

## 선분 이력

- 데이터 변경의 시작 시점부터 종료 시점까지 관리하는 것으로, 데이터를 변경하는 행위가 발생하여 유지되는 정보를 관리한다.
- 정밀한 이력관리가 가능하고, 변화가 발생할 때만 이력 데이터를 생성할 수 있다.
- 임의 시점 데이터를 재현할  수 있다.
- 선분 이력을 관리하는 엔티티의 UID를 확정하는 것은 향후에 테이블로 만들어지고 사용될 때의 성능 측면도 고려되어야 한다.

### **선분 이력 관리 유형**

1. 인스턴스 레벨 이력 관리
   - 하나의 인스턴스의 어떤 변경이라도 발생하면 전체 인스턴스를 새롭게 생성하는 방법이다.
2. 속성 레벨 이력 관리
   - 이력을 관리할 대상 속성에서 변화가 생길 때만 이력을 생성하는 방법이다.
3. 주제 레벨 이력 관리
   - 내용이 유사하거나 연동될 확률이 높은 것 별로 인스턴스 레벨 이력을 관리하는 방법이다.

# Reference

- http://www.dbguide.net/db.db?cmd=view&boardUid=12856&boardConfigUid=9&categoryUid=216&boardIdx=41&boardStep=1
- https://daitso.kbhub.co.kr/47724/